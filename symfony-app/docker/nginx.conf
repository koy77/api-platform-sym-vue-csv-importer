server {
    listen 80;
    server_name localhost;
    root /var/www/html/public;
    index index.php index.html;

    # Serve Vue.js dashboard assets
    location /resources/ {
        alias /var/www/html/resources/;
        try_files $uri =404;
    }

    # API routes
    location /api {
        try_files $uri /index.php$is_args$args;
    }

    # PHP files
    location ~ \.php$ {
        fastcgi_pass php:9000;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Serve Vue.js dashboard assets from build directory
    location /build/ {
        alias /var/www/html/public/build/;
        try_files $uri =404;
    }

    # Serve Vue.js dashboard assets (without /build prefix)
    location /assets/ {
        alias /var/www/html/public/build/assets/;
        try_files $uri =404;
        # Set correct MIME types
        types {
            application/javascript js mjs;
            text/css css;
        }
        default_type application/javascript;
    }

    # Root - serve index.html for Vue dashboard first
    location = / {
        try_files /build/index.html =404;
    }
    
    # Root directory - serve dashboard or fallback to Symfony
    location / {
        try_files $uri $uri/ /build/index.html /index.php$is_args$args;
    }

    location ~ /\.ht {
        deny all;
    }
}

